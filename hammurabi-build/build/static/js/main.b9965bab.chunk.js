(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{112:function(e,t,n){e.exports=n(296)},258:function(e,t,n){},259:function(e,t,n){},294:function(e,t,n){},296:function(e,t,n){"use strict";n.r(t);var a=n(0),s=n.n(a),r=n(17),o=n.n(r),i=n(14);const l={sort:function(e){if("string"===typeof e)return localStorage.getItem(e);{let t={};for(let n in e)t[n]=localStorage.getItem(n);return t}}("sort")||"top",comments:[],question:null,processed:null,stage:0,options:{song:null,theme:null}};function c(e,t){return Object.assign({},e,t)}var h=Object(i.d)(function(e=l,t){switch(t.type){case"SET_SORT":let n={sort:t.val};return console.log(t.val),function(e,t){if("object"===typeof e)for(let n in e)localStorage.setItem(n,e[n]);else localStorage.setItem(e,t)}("sort",n),c(e,n);case"SET_STAGE":return c(e,{stage:t.val});case"INC_STAGE":return c(e,{stage:e.stage+t.val});case"SET_COMMENTS":return c(e,{comments:t.val});case"SET_PROCESSED":return c(e,{processed:t.val});case"SET_QUESTION":return c(e,{question:t.val});case"SET_TITLE":let a=c(e.question,{title:t.val});return c(e,{question:a});case"SET_OPTIONS":return c(e,{options:t.val});default:return e}}),m=n(4),p=n(111),u=n(5),d=n(104),g=n.n(d),E=n(105);const b=[/(f)(uck)()/,/(sh)(it)()/,/(b)(it)(ch)/,/(c)(un)(t)/,/(ni)(gg)(a)/,/(ni)(gge)(r)/,/(p)(o)(rn)/,/((?:\W|^)d)(ic)(k)/,/((?:\W|^)a)(ss)(es)(?!\w)/,/((?:\W|^)a)(ss)(\W|$)/,/((?:\W|^)r)(ap)(e|ist|ing)/,/((?:\W|^)c)(u)(m)/,/((?:\W|^)t)(i)(ts)/,/(t)(it)(ties)/,/(c)(o)(ck[^an])/,/(wh)(or)(e)/,/(p)(us)(sy)/,/(s)(e)(x)/,/(d)(ic)(k)/,/(ret)(ar)(d)/,/(a)(ss)(hat|face|head|burger|hole)/,/((?:\W|^)a)(n)(al[^oy])/,/(pe)(n)(is)/,/(va)(gi)(na)/,/(dr)(u)(gs)/,/(mast)(urb)(at)/,/(dr)(u)(gs)/];var v=n(106),f=n.n(v),S=n(107),y=n.n(S),C=n(33);function T(e,t,n){const a=t.getText();let s,r;for(;null!==(s=e.exec(a));)n(r=s.index,r+s[0].length)}let k=[{strategy:function(e,t){b.forEach(n=>{T(new RegExp(n,"ig"),e,t)})},component:e=>s.a.createElement("span",{className:"highlight-danger"},e.children)},{strategy:function(e,t){T(/(?:^|\W)edit/gim,e,t)},component:e=>s.a.createElement("span",{className:"highlight-warn"},e.children)}];class x extends s.a.Component{constructor(e){super(e),this.inlineToolbarPlugin=y()(),this.linkPlugin=f()(),this.plugins=[this.inlineToolbarPlugin,this.linkPlugin];let t=Object(u.convertFromHTML)(e.comment.data.body_html);this.state={editor:u.EditorState.createWithContent(u.ContentState.createFromBlockArray(t.contentBlocks,t.entityMap))}}handlePress(e){e.stopPropagation()}propagateHtmlChange(e){this.setState({editor:e});let t=Object(E.stateToHTML)(this.state.editor.getCurrentContent());this.props.comment.data.body_html=t,this.props.onChange()}propagateEnableChange(){this.props.comment.enabled=!this.props.comment.enabled,this.props.onChange()}render(){let e=this.props,t=e.comment,n=e.onChange;return s.a.createElement("div",{className:"Comment"},s.a.createElement("input",{className:"left-box",type:"checkbox",checked:t.enabled,onChange:this.propagateEnableChange.bind(this)}),s.a.createElement("div",{onKeyDown:this.handlePress},s.a.createElement("div",{onClick:this.propagateEnableChange.bind(this)},s.a.createElement("span",{style:{color:"blue",marginRight:5}},t.data.author),s.a.createElement("span",null,t.data.score>1e3?Math.round(t.data.score/100)/10+"k":t.data.score," points"),s.a.createElement("span",null,t.data.all_awardings.map(e=>s.a.createElement(s.a.Fragment,null,s.a.createElement("img",{src:e.icon_url,alt:"award",width:16}),e.count>1&&e.count)))),s.a.createElement(g.a,{editorState:this.state.editor,onChange:this.propagateHtmlChange.bind(this),decorators:k,plugins:this.plugins}),s.a.createElement(this.inlineToolbarPlugin.InlineToolbar,null,e=>s.a.createElement(s.a.Fragment,null,s.a.createElement(C.BoldButton,e),s.a.createElement(C.ItalicButton,e),s.a.createElement(C.UnderlineButton,e),s.a.createElement(this.linkPlugin.LinkButton,e))),Array.isArray(t.data.replies)&&t.data.replies.map(e=>s.a.createElement(x,{key:e.data.id,comment:e,onChange:n}))))}}var N=x;n(258);let w=13.163,O=.741;n(259);class j extends s.a.Component{render(){let e=this.props.comment;return s.a.createElement("div",{className:"FakeComment"},s.a.createElement("div",{dangerouslySetInnerHTML:{__html:e.data.body_html}}),e.data.replies&&e.data.replies.filter&&e.data.replies.filter(e=>e.enabled).map(e=>s.a.createElement(j,{key:e.data.id,comment:e})))}}var P=j;const D=e=>({type:"SET_QUESTION",val:e}),_=()=>({type:"INC_STAGE",val:1}),I=e=>({type:"SET_COMMENTS",val:e}),A=e=>({type:"SET_OPTIONS",val:e});var M=n(44);let q=e=>Object.keys(e).filter(t=>e[t]).join(" ");var B=class extends s.a.Component{constructor(e){super(e),this.onDragEnd=this.onDragEnd.bind(this)}onDragEnd(e){e.destination&&this.props.reorder(e.source.index,e.destination.index)}render(){return s.a.createElement(M.a,{onDragEnd:this.onDragEnd},s.a.createElement(M.c,{droppableId:"droppable"},e=>s.a.createElement("div",Object.assign({},e.droppableProps,{ref:e.innerRef,className:"draggable-container"}),this.props.items.map((e,t)=>s.a.createElement(M.b,{key:e.data.id,draggableId:e.data.id,index:t},n=>s.a.createElement("div",Object.assign({ref:n.innerRef},n.draggableProps,n.dragHandleProps,{className:q({draggable:!0,current:this.props.current===t,enabled:e.enabled}),onClick:()=>this.props.setCurrent(t)})))),e.placeholder)))}};var W=Object(m.b)(e=>({comments:e.comments}),{setProcessed:e=>({type:"SET_PROCESSED",val:e}),setComments:I,nextStage:_})(class extends s.a.Component{constructor(e){super(e),this.state={current:0,tooTall:!1,height:0},this.onSubmit=this.onSubmit.bind(this),this.handle=this.handle.bind(this),this.toggleCurrent=this.toggleCurrent.bind(this),this.handleKeyEvent=this.handleKeyEvent.bind(this),this.fakecomments=s.a.createRef()}handleKeyEvent(e){switch(e.code){case"KeyA":case"ArrowLeft":this.goPrev();break;case"KeyD":case"ArrowRight":this.goNext();break;case"Enter":this.onSubmit();break;default:if(0===e.code.indexOf("Digit")){let t=parseInt(e.code.replace("Digit",""));this.toggleCurrent(t)}}}componentDidMount(){window.addEventListener("keydown",this.handleKeyEvent)}componentWillUnmount(){window.removeEventListener("keydown",this.handleKeyEvent)}goPrev(){this.state.current>0&&this.setState({current:this.state.current-1})}goNext(){this.state.current<this.props.comments.length-1&&this.setState({current:this.state.current+1})}onSubmit(){let e=function e(t){return t.filter(e=>e.enabled).map(e=>e.data).map(t=>{let n=Object.assign({},t);return n.replies&&(n.replies=e(n.replies)),n})}(this.props.comments);this.props.setProcessed(e),this.props.nextStage()}handle(e){this.state.chosen.has(e)?this.state.chosen.set(e):this.state.chosen.add(e),this.setState({chosen:this.state.chosen})}toggleCurrent(e){let t=Array.from(this.props.comments);if(e){let n=0,a=function t(a){if(++n===e)return a;if(Array.isArray(a.data.replies))for(let e=0;e<a.data.replies.length;e++){let n=t(a.data.replies[e]);if(n)return n}}(t[this.state.current]);if(!a)return;a.enabled=!a.enabled}else t[this.state.current].enabled=!t[this.state.current].enabled;this.props.setComments(t)}toMinSec(e){let t=Math.floor(e/60),n=("00"+Math.round(e-60*t)).slice(-2);return`${("00"+t).slice(-2)}:${n}`}calculateTotalTime(){let e=t=>{let n=t.data.body_html;return Array.isArray(t.data.replies)&&(n+=t.data.replies.filter(e=>e.enabled).map(e).reduce((e,t)=>e+t,"")),n},t=this.props.comments.filter(e=>e.enabled).map(e).map(e=>(function(e){let t=e.replace(/<.+?>/g,"").trim(),n=(a=t,a.split(/<br>|(.+?[\.,?!]+["'\)\s]+)/g).filter(e=>e.replace("\u200b"," ").trim().length>0)).length;var a;let s=t.replace(/<.+?>/g,"").split(/\s+/g).length;return{words:s,splits:n,estimate:function(e,t){return.38152203637725923*e+.2767486833003453*t}(n,s)}})(e).estimate);return Math.round(100*function(e){return e.reduce((e,t)=>e+t,0)+w+O*e.length}(t))/100}onCurrentCommentChange(e){let t=Array.from(this.props.comments);this.props.setComments(t)}componentDidUpdate(){let e=this.fakecomments.current.clientHeight,t={},n=!1;this.state.height!==e&&(t.height=e,n=!0),this.state.tooTall!==e>450&&(t.tooTall=e>450,n=!0),n&&this.setState(t)}onReorder(e,t){this.props.setComments(((e,t,n)=>{const a=Array.from(e),s=a.splice(t,1),r=Object(p.a)(s,1)[0];return a.splice(n,0,r),a})(this.props.comments,e,t));let n=this.state.current;n===e?this.setState({current:t}):n<e&&n>t?this.setState({current:n+1}):n>e&&n<t&&this.setState({current:n-1})}render(){let e=this.props.comments[this.state.current],t=this.props.comments.filter(e=>e.enabled).length;return s.a.createElement("div",{style:{display:"flex",flexDirection:"row",justifyContent:"center",marginTop:5}},s.a.createElement(B,{setCurrent:e=>this.setState({current:e}),current:this.state.current,reorder:this.onReorder.bind(this),items:this.props.comments}),s.a.createElement("div",{className:"Comments"},s.a.createElement("div",null,s.a.createElement("div",{className:"top-comment"},s.a.createElement(N,{key:e.data.id,comment:e,onChange:this.onCurrentCommentChange.bind(this)})),s.a.createElement("div",{className:"options"},s.a.createElement("label",null,s.a.createElement("input",{type:"checkbox",checked:e.enabled,onChange:()=>this.toggleCurrent.bind(this)(1)}),"Enable"),s.a.createElement("div",{className:this.state.tooTall?"tooTall":""},"Height: ",this.state.height," (max=450)")),s.a.createElement("div",{className:"controls"},s.a.createElement("button",{disabled:this.state.current<=0,onClick:this.goPrev.bind(this)},"Prev"),s.a.createElement("input",{style:{width:60},type:"number",max:this.props.comments.length,min:1,value:this.state.current+1,onChange:e=>this.setState({current:Math.max(0,parseInt(e.target.value)-1||0)})}),s.a.createElement("button",{disabled:this.state.current>this.props.comments.length,onClick:this.goNext.bind(this)},"Next")),s.a.createElement("div",{className:"controls"},s.a.createElement("span",null,"Total time: ",this.toMinSec(this.calculateTotalTime()),", ",t," ",1===t?"comment":"comments"," selected"),s.a.createElement("button",{onClick:this.onSubmit},"Finish"))),s.a.createElement("div",{className:"fake-container",ref:this.fakecomments},s.a.createElement(P,{comment:e}))))}});var R=Object(m.b)(e=>({title:e.question.title}),{setTitle:e=>({type:"SET_TITLE",val:e}),nextStage:_})(class extends s.a.Component{onSubmit(e){e.preventDefault(),this.props.nextStage()}onChange(e){this.props.setTitle(e.target.value)}render(){return s.a.createElement("div",{className:"Question"},s.a.createElement("h1",null,"Edit question"),s.a.createElement("form",{onSubmit:this.onSubmit.bind(this)},s.a.createElement("textarea",{defaultValue:this.props.title,className:"question-title",onChange:this.onChange.bind(this),style:{width:500,fontFamily:"Noto Sans"}}),s.a.createElement("br",null),s.a.createElement("button",{type:"submit"},"Submit")))}});let L="http://localhost:5566/api";let K=function(){return fetch(L+"/get-last-edit/").then(e=>e.ok?e.json():e.json().then(e=>{throw e})).then(({questionData:e,commentData:t,options:n})=>{D(e),I(t),A(n)})},F=function(e){let t=h.getState(),n=(a={sort:t.sort},Object.keys(a).map(e=>{let t=a[e];return!0===t?e:null!=t?e+"="+t:null}).filter(e=>null!=e).join("&"));var a;return fetch(L+"/get-thread/"+e+"?"+n).then(e=>e.ok?e.json():e.json().then(e=>{throw e}))},H=function(){return fetch(L+"/get-themes").then(e=>e.json())},G=function(e,t,n){return fetch(L+"/render-video",{method:"POST",body:JSON.stringify({questionData:e,commentData:t,options:n})}).then(e=>e.json())};var Q=Object(m.b)(e=>({sortBy:e.sortBy}),{setComments:I,setQuestion:D,nextStage:_,setSort:e=>({type:"SET_SORT",val:e})})(class extends s.a.Component{constructor(e){super(e),this.state={input:"",loading:null,error:null},this.fetchThread=this.fetchThread.bind(this),this.onSubmit=this.onSubmit.bind(this),this.handle=this.handle.bind(this)}fetchThread(e){this.setState({error:null,loading:!0}),F(e).then(e=>{let t=e=>{let n=Object.assign({},e);return Array.isArray(n.replies)&&(n.replies=n.replies.map(t)),{enabled:!1,data:n}},n=e.commentData.map(t);this.props.setQuestion(e.questionData),this.props.setComments(n),this.props.nextStage()}).catch(e=>{console.error(e),this.setState({error:e.message,loading:!1})})}onSubmit(e){e.preventDefault(),e.stopPropagation();let t=this.state.input;if(-1!==t.indexOf("comments")){let e=/\/comments\/([\w]+)/,n=t.match(e);n&&(t=n[1])}let n=t.replace(/[^\w\d]/g,"");this.fetchThread(n)}loadLast(){K().then(e=>{this.props.nextStage()})}handle(e){this.setState({input:e.target.value})}render(){return s.a.createElement("div",{className:"def-container"},s.a.createElement("h1",null,"Choose a thread"),s.a.createElement("div",null,s.a.createElement("form",{onSubmit:this.onSubmit},s.a.createElement("div",{className:"form-group"},s.a.createElement("input",{className:"full",value:this.state.input,onChange:this.handle,placeholder:"Put thread ID or url",autoFocus:!0})),s.a.createElement("div",{className:"form-group"},s.a.createElement("select",{defaultValue:this.props.sortBy,onChange:e=>e.target.value&&this.props.setSort(e.target.value),className:"full"},s.a.createElement("option",{value:"top"},"Top"),s.a.createElement("option",{value:"best"},"Best"),s.a.createElement("option",{value:"new"},"New"))),s.a.createElement("div",{className:"form-group"},s.a.createElement("button",{className:"big",type:"submit"},"OK")))),s.a.createElement("div",null,this.state.loading&&s.a.createElement("p",{className:"loader"},"Loading..."),this.state.error&&s.a.createElement("p",{style:{color:"red"}},this.state.error)))}});var U=Object(m.b)(e=>({question:e.question,processed:e.processed,options:e.options}),{setOptions:A,nextStage:_})(class extends s.a.Component{constructor(e){super(e),this.state={themes:[]},H().then(e=>{this.setState({themes:e})}),this.onSubmit=this.onSubmit.bind(this),this.changeSong=this.changeSong.bind(this),this.changeTheme=this.changeTheme.bind(this)}onSubmit(e){e.preventDefault(),G(this.props.question,this.props.processed,this.props.options),this.props.nextStage()}changeSong(e){let t={song:e.target.value,theme:this.props.options.theme};this.props.setOptions(t)}changeTheme(e){let t={song:null,theme:e.target.value};this.props.setOptions(t)}render(){let e=this.state.themes.find(e=>e.name===this.props.options.theme);return s.a.createElement("div",{className:"Thread"},s.a.createElement("form",{onSubmit:this.onSubmit},s.a.createElement("div",null,s.a.createElement("select",{value:this.props.options.theme||"",style:{display:"block",margin:"0 auto"},onChange:this.changeTheme},s.a.createElement("option",{value:""},"Select a theme"),this.state.themes.map(e=>s.a.createElement("option",{value:e.name,key:e.name},e.name))),s.a.createElement("select",{value:this.props.options.song||"",disabled:!this.props.options.theme,style:{display:"block",margin:"10px auto"},onChange:this.changeSong},s.a.createElement("option",{value:""},"Select a song"),e&&e.songs.map(e=>s.a.createElement("option",{value:e,key:e},e)))),s.a.createElement("div",null,s.a.createElement("button",{type:"submit",disabled:!this.props.options.theme||!this.props.options.song},"Send to the slaughterhouse"))))}});n(294),n(295);var $=Object(m.b)(e=>({question:e.question,processed:e.processed,stage:e.stage,options:e.options}),{prevStage:()=>({type:"INC_STAGE",val:-1}),nextStage:_})(class extends s.a.Component{render(){return s.a.createElement("div",{className:"App"},0===this.props.stage?s.a.createElement(Q,null):1===this.props.stage?s.a.createElement(R,null):2===this.props.stage?s.a.createElement(W,null):3===this.props.stage?s.a.createElement(U,null):4===this.props.stage?s.a.createElement("div",null,s.a.createElement("h1",null,"rendering atm bro"),s.a.createElement("p",null,"You may close this tab")):null,s.a.createElement("br",null),0!==this.props.stage&&s.a.createElement("div",null,s.a.createElement("button",{style:{fontSize:12,marginTop:"1rem"},onClick:this.props.prevStage},"GO BACK!")))}});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(s.a.createElement(m.a,{store:h},s.a.createElement($,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[112,1,2]]]);
//# sourceMappingURL=main.b9965bab.chunk.js.map