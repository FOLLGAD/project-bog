(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{166:function(t,e,n){},167:function(t,e,n){"use strict";n.r(e);var a=n(0),s=n.n(a),i=n(32),o=n.n(i),r=n(1),c=n(2),l=n(4),u=n(3),h=n(5),m="http://localhost:5566/api",d=function(){return fetch(m+"/get-songs").then(function(t){return t.json()})},b=(n(60),n(8)),g=n(54),v=n.n(g),f=function(t){function e(){return Object(r.a)(this,e),Object(l.a)(this,Object(u.a)(e).apply(this,arguments))}return Object(h.a)(e,t),Object(c.a)(e,[{key:"handlePress",value:function(t){t.stopPropagation()}},{key:"render",value:function(){var t=this.props,e=t.body_html,n=t.onChange;return s.a.createElement("div",{className:"Comment"},s.a.createElement(v.a,{onKeyDown:this.handlePress,theme:null,value:e,onChange:n}))}}]),e}(s.a.Component),p=(n(166),13.163),y=.843;function E(t){var e,n=t.replace(/<.+?>/g,"").trim(),a=(e=n,e.split(/<br>|(.+?[\.,?!]+["'\)\s]+)/g).filter(function(t){return t.replace("\u200b"," ").trim().length>0})).length,s=n.replace(/<.+?>/g,"").split(/\s+/g).length;return{words:s,splits:a,estimate:function(t,e){return.38152203637725923*t+.2767486833003453*e}(a,s)}}var k=function(t){function e(t){var n;Object(r.a)(this,e),n=Object(l.a)(this,Object(u.a)(e).call(this,t));var a=t.comments.map(function(t){return{enabled:!1,data:t}});return n.state={current:0,settings:a},n.onSubmit=n.onSubmit.bind(Object(b.a)(n)),n.handle=n.handle.bind(Object(b.a)(n)),n.toggleCurrent=n.toggleCurrent.bind(Object(b.a)(n)),n.handleKeyEvent=n.handleKeyEvent.bind(Object(b.a)(n)),n}return Object(h.a)(e,t),Object(c.a)(e,[{key:"handleKeyEvent",value:function(t){switch(t.code){case"KeyA":case"ArrowLeft":this.goPrev();break;case"KeyD":case"ArrowRight":this.goNext();break;case"KeyE":case"Space":this.toggleCurrent();break;case"Enter":this.onSubmit()}}},{key:"componentDidMount",value:function(){window.addEventListener("keydown",this.handleKeyEvent)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("keydown",this.handleKeyEvent)}},{key:"goPrev",value:function(){this.state.current>0&&this.setState({current:this.state.current-1})}},{key:"goNext",value:function(){this.state.current<this.state.settings.length-1&&this.setState({current:this.state.current+1})}},{key:"onSubmit",value:function(){var t=this.state.settings.filter(function(t){return t.enabled});this.props.onSelection(t)}},{key:"handle",value:function(t){this.state.chosen.has(t)?this.state.chosen.set(t):this.state.chosen.add(t),this.setState({chosen:this.state.chosen})}},{key:"toggleCurrent",value:function(){var t=this.state.settings,e=t[this.state.current];e.enabled=!e.enabled,t[this.state.current]=e,console.log(t[this.state.current]),this.setState({settings:t})}},{key:"toMinSec",value:function(t){var e=Math.floor(t/60),n=("00"+Math.round(t-60*e)).slice(-2),a=("00"+e).slice(-2);return"".concat(a,":").concat(n)}},{key:"calculateTotalTime",value:function(){var t=this.state.settings.filter(function(t){return t.enabled}).map(function(t){return t.data.body_html}).map(function(t){return E(t).estimate});return Math.round(100*function(t){return t.reduce(function(t,e){return t+e},0)+p+y*t.length}(t))/100}},{key:"onCurrentCommentChange",value:function(t){var e=this.state.settings,n=e[this.state.current].data;n.body_html=t,e[this.state.current].data=n,this.setState({settings:e})}},{key:"render",value:function(){var t=this,e=this.state.settings[this.state.current].data,n=this.state.settings.filter(function(t){return t.enabled}).length,a=E(e.body_html),i=a.estimate,o=a.words,r=a.splits;return s.a.createElement("div",{className:"Comments"},s.a.createElement("div",null,s.a.createElement(f,{body_html:e.body_html,onChange:this.onCurrentCommentChange.bind(this)}),s.a.createElement("div",{className:"options"},s.a.createElement("label",null,s.a.createElement("input",{type:"checkbox",checked:this.state.settings[this.state.current].enabled,onChange:this.toggleCurrent.bind(this)}),"Enable"),s.a.createElement("div",null,"Estimate: ",Math.round(100*i)/100," s, ",o,"/",r)),s.a.createElement("div",{className:"controls"},s.a.createElement("button",{disabled:this.state.current<=0,onClick:this.goPrev.bind(this)},"Prev"),s.a.createElement("input",{style:{width:60},type:"number",value:this.state.current+1,onChange:function(e){return t.setState({current:Math.max(0,parseInt(e.target.value)-1||0)})}}),s.a.createElement("button",{disabled:this.state.current>this.state.settings.length,onClick:this.goNext.bind(this)},"Next")),s.a.createElement("div",{className:"controls"},s.a.createElement("span",null,"Total time: ",this.toMinSec(this.calculateTotalTime()),", ",n," ",1===n?"comment":"comments"," selected"),s.a.createElement("button",{onClick:this.onSubmit},"Finish"))))}}]),e}(s.a.Component),S=function(t){function e(t){var n;return Object(r.a)(this,e),(n=Object(l.a)(this,Object(u.a)(e).call(this,t))).state={thread:""},n}return Object(h.a)(e,t),Object(c.a)(e,[{key:"onSubmit",value:function(t){t.preventDefault(),this.props.onSelection(this.state.thread)}},{key:"handle",value:function(t){this.setState({thread:t.target.value})}},{key:"render",value:function(){return s.a.createElement("div",{className:"Thread"},s.a.createElement("h1",null,"Choose a thread"),s.a.createElement("form",{onSubmit:this.onSubmit.bind(this)},s.a.createElement("input",{value:this.state.thread,onChange:this.handle.bind(this),placeholder:"Choose a thread",autoFocus:!0}),s.a.createElement("button",null,"OK")))}}]),e}(s.a.Component),j=function(t){function e(t){var n;return Object(r.a)(this,e),(n=Object(l.a)(this,Object(u.a)(e).call(this,t))).state={song:null,songs:null},d().then(function(t){n.setState({songs:t,song:t[0]})}),n}return Object(h.a)(e,t),Object(c.a)(e,[{key:"onSubmit",value:function(t){t.preventDefault(),this.props.onSelection({song:this.state.song})}},{key:"changeSong",value:function(t){this.setState({song:t.target.value})}},{key:"render",value:function(){return s.a.createElement("div",{className:"Thread"},s.a.createElement("form",{onSubmit:this.onSubmit.bind(this)},this.state.songs&&s.a.createElement("select",{onChange:this.changeSong.bind(this)},this.state.songs.map(function(t){return s.a.createElement("option",{key:t},t)})),s.a.createElement("br",null),s.a.createElement("button",{type:"submit"},"Send to the slaughterhouse")))}}]),e}(s.a.Component),O=function(t){function e(t){var n;return Object(r.a)(this,e),(n=Object(l.a)(this,Object(u.a)(e).call(this,t))).state={stage:0,comments:[],question:null,processed:null,options:{song:null}},n}return Object(h.a)(e,t),Object(c.a)(e,[{key:"fetchThread",value:function(t){var e=this;(function(t){return fetch(m+"/get-thread/"+t).then(function(t){return t.json()})})(t).then(function(t){e.setState({question:t[0],comments:t[1],stage:1})})}},{key:"commentsDone",value:function(t){console.log(t),this.setState({processed:t,stage:2})}},{key:"addSettings",value:function(t){console.log(t),this.setState({options:t,stage:3}),function(t,e,n){fetch(m+"/render-video",{method:"POST",body:JSON.stringify({questionData:t,commentData:e,options:n})}).then(function(t){return t.json()})}(this.state.question,this.state.processed,t)}},{key:"render",value:function(){return 0===this.state.stage?s.a.createElement("div",{className:"App"},s.a.createElement(S,{onSelection:this.fetchThread.bind(this)})):1===this.state.stage?s.a.createElement("div",{className:"App"},s.a.createElement(k,{onSelection:this.commentsDone.bind(this),comments:this.state.comments})):2===this.state.stage?s.a.createElement("div",{className:"App"},s.a.createElement(j,{onSelection:this.addSettings.bind(this)})):3===this.state.stage?s.a.createElement("div",{className:"App"},s.a.createElement("h1",null,"rendering atm bro"),s.a.createElement("p",null,"You may close this tab")):void 0}}]),e}(s.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(s.a.createElement(O,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(t){t.unregister()})},55:function(t,e,n){t.exports=n(167)},60:function(t,e,n){}},[[55,1,2]]]);
//# sourceMappingURL=main.f28256f8.chunk.js.map