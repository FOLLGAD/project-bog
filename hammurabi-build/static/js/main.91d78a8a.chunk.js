(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{170:function(e,t,a){},171:function(e,t,a){},172:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),i=a(10),r=a.n(i),o=a(22);const l={comments:[],question:null,processed:null,stage:0,options:{song:null}};var c=Object(o.b)(function(e=l,t){switch(t.type){case"SET_STAGE":return Object.assign({},e,{stage:t.val});case"INC_STAGE":return Object.assign({},e,{stage:e.stage+t.val});case"SET_COMMENTS":return Object.assign({},e,{comments:t.val});case"SET_PROCESSED":return Object.assign({},e,{processed:t.val});case"SET_QUESTION":return Object.assign({},e,{question:t.val});case"SET_TITLE":let a=Object.assign({},e.question,{title:t.val});return Object.assign({},e,{question:a});case"SET_OPTIONS":return Object.assign({},e,{options:t.val});default:return e}}),h=a(5);let m="http://localhost:5566/api",d=function(e){return fetch(m+"/get-thread/"+e).then(e=>e.json())},p=function(){return fetch(m+"/get-songs").then(e=>e.json())},u=function(e,t,a){return console.log(a),fetch(m+"/render-video",{method:"POST",body:JSON.stringify({questionData:e,commentData:t,options:a})}).then(e=>e.json())};a(66);var g=a(55),b=a.n(g);class E extends s.a.Component{handlePress(e){e.stopPropagation()}propagateHtmlChange(e){this.props.comment.data.body_html=e,this.props.onChange()}propagateEnableChange(){this.props.comment.enabled=!this.props.comment.enabled,this.props.onChange()}render(){let e=this.props,t=e.comment,a=e.onChange;return s.a.createElement("div",{className:"Comment"},s.a.createElement("input",{className:"left-box",type:"checkbox",checked:t.enabled,onChange:this.propagateEnableChange.bind(this)}),s.a.createElement("div",null,s.a.createElement("div",{onClick:this.propagateEnableChange.bind(this)},s.a.createElement("span",{style:{color:"blue",marginRight:5}},t.data.author),s.a.createElement("span",null,t.data.score>1e3?Math.round(t.data.score/100)/10+"k":t.data.score," points"),s.a.createElement("span",{className:"gilding"},t.data.gildings.gid_3>0&&s.a.createElement("img",{src:"https://www.redditstatic.com/desktop2x/img/gold/badges/award-platinum-cartoon.png",alt:"platinum",width:16}),t.data.gildings.gid_3>1&&t.data.gildings.gid_3),s.a.createElement("span",{className:"gilding"},t.data.gildings.gid_2>0&&s.a.createElement("img",{src:"https://www.redditstatic.com/desktop2x/img/gold/badges/award-gold-cartoon.png",alt:"gold",width:16}),t.data.gildings.gid_2>1&&t.data.gildings.gid_2),s.a.createElement("span",{className:"gilding"},t.data.gildings.gid_1>0&&s.a.createElement("img",{src:"https://www.redditstatic.com/desktop2x/img/gold/badges/award-silver-cartoon.png",alt:"silver",width:16}),t.data.gildings.gid_1>1&&t.data.gildings.gid_1)),s.a.createElement(b.a,{style:{display:"inline-block"},onKeyDown:this.handlePress,theme:null,value:t.data.body_html,onChange:this.propagateHtmlChange.bind(this)}),Array.isArray(t.data.replies)&&t.data.replies.map(e=>s.a.createElement(E,{key:e.data.id,comment:e,onChange:a}))))}}var S=E;a(170);let v=13.163,f=.741;a(171);class C extends s.a.Component{render(){let e=this.props.comment;return s.a.createElement("div",{className:"FakeComment"},s.a.createElement("div",{dangerouslySetInnerHTML:{__html:e.data.body_html}}),e.data.replies&&e.data.replies.filter&&e.data.replies.filter(e=>e.enabled).map(e=>s.a.createElement(C,{key:e.data.id,comment:e})))}}var y=C;const T=()=>({type:"INC_STAGE",val:1}),w=e=>({type:"SET_COMMENTS",val:e});var O=Object(h.b)(e=>({comments:e.comments}),{setProcessed:e=>({type:"SET_PROCESSED",val:e}),setComments:w,nextStage:T})(class extends s.a.Component{constructor(e){super(e),this.state={current:0,tooTall:!1,height:0},this.onSubmit=this.onSubmit.bind(this),this.handle=this.handle.bind(this),this.toggleCurrent=this.toggleCurrent.bind(this),this.handleKeyEvent=this.handleKeyEvent.bind(this),this.fakecomments=s.a.createRef()}handleKeyEvent(e){switch(e.code){case"KeyA":case"ArrowLeft":this.goPrev();break;case"KeyD":case"ArrowRight":this.goNext();break;case"Enter":this.onSubmit();break;default:if(0===e.code.indexOf("Digit")){let t=parseInt(e.code.replace("Digit",""));this.toggleCurrent(t)}}}componentDidMount(){window.addEventListener("keydown",this.handleKeyEvent)}goPrev(){this.state.current>0&&this.setState({current:this.state.current-1})}goNext(){this.state.current<this.props.comments.length-1&&this.setState({current:this.state.current+1})}onSubmit(){let e=function e(t){return t.filter(e=>e.enabled).map(e=>e.data).map(t=>{let a=Object.assign({},t);return a.replies&&(a.replies=e(a.replies)),a})}(this.props.comments);this.props.setProcessed(e),this.props.nextStage()}handle(e){this.state.chosen.has(e)?this.state.chosen.set(e):this.state.chosen.add(e),this.setState({chosen:this.state.chosen})}toggleCurrent(e){let t=this.props.comments;if(e){let a=0,n=function t(n){if(++a===e)return n;if(Array.isArray(n.data.replies))for(let e=0;e<n.data.replies.length;e++){let a=t(n.data.replies[e]);if(a)return a}}(t[this.state.current]);if(!n)return;n.enabled=!n.enabled}else{let e=t[this.state.current];e.enabled=!e.enabled,t[this.state.current]=e}this.forceUpdate(),this.forceUpdate(),this.props.setComments(t)}toMinSec(e){let t=Math.floor(e/60),a=("00"+Math.round(e-60*t)).slice(-2);return`${("00"+t).slice(-2)}:${a}`}calculateTotalTime(){let e=t=>{let a=t.data.body_html;return Array.isArray(t.data.replies)&&(a+=t.data.replies.filter(e=>e.enabled).map(e).reduce((e,t)=>e+t,"")),a},t=this.props.comments.filter(e=>e.enabled).map(e).map(e=>(function(e){let t=e.replace(/<.+?>/g,"").trim(),a=(n=t,n.split(/<br>|(.+?[\.,?!]+["'\)\s]+)/g).filter(e=>e.replace("\u200b"," ").trim().length>0)).length;var n;let s=t.replace(/<.+?>/g,"").split(/\s+/g).length;return{words:s,splits:a,estimate:function(e,t){return.38152203637725923*e+.2767486833003453*t}(a,s)}})(e).estimate);return Math.round(100*function(e){return e.reduce((e,t)=>e+t,0)+v+f*e.length}(t))/100}onCurrentCommentChange(e){this.props.setComments(this.props.comments)}componentDidUpdate(){let e=this.fakecomments.current.clientHeight;this.state.tooTall=e>450,this.state.height=e}render(){let e=this.props.comments[this.state.current],t=this.props.comments.filter(e=>e.enabled).length;return s.a.createElement("div",{className:"Comments"},s.a.createElement("div",null,s.a.createElement("div",{className:"top-comment"},s.a.createElement(S,{comment:e,onChange:this.onCurrentCommentChange.bind(this)})),s.a.createElement("div",{className:"options"},s.a.createElement("label",null,s.a.createElement("input",{type:"checkbox",checked:e.enabled,onChange:()=>this.toggleCurrent.bind(this)(1)}),"Enable"),s.a.createElement("div",{className:this.state.tooTall?"tooTall":""},"Height: ",this.state.height," (max=450)")),s.a.createElement("div",{className:"controls"},s.a.createElement("button",{disabled:this.state.current<=0,onClick:this.goPrev.bind(this)},"Prev"),s.a.createElement("input",{style:{width:60},type:"number",max:this.props.comments.length,min:1,value:this.state.current+1,onChange:e=>this.setState({current:Math.max(0,parseInt(e.target.value)-1||0)})}),s.a.createElement("button",{disabled:this.state.current>this.props.comments.length,onClick:this.goNext.bind(this)},"Next")),s.a.createElement("div",{className:"controls"},s.a.createElement("span",null,"Total time: ",this.toMinSec(this.calculateTotalTime()),", ",t," ",1===t?"comment":"comments"," selected"),s.a.createElement("button",{onClick:this.onSubmit},"Finish"))),s.a.createElement("div",{className:"fake-container",ref:this.fakecomments},s.a.createElement(y,{comment:e})))}});var N=Object(h.b)(e=>({title:e.question.title}),{setTitle:e=>({type:"SET_TITLE",val:e}),nextStage:T})(class extends s.a.Component{onSubmit(e){e.preventDefault(),this.props.nextStage()}onChange(e){this.props.setTitle(e.target.value)}render(){return s.a.createElement("div",{className:"Question"},s.a.createElement("h1",null,"Edit question"),s.a.createElement("form",{onSubmit:this.onSubmit.bind(this)},s.a.createElement("textarea",{className:"question-title",onChange:this.onChange.bind(this),style:{width:500,fontFamily:"Noto Sans"}},this.props.title),s.a.createElement("br",null),s.a.createElement("button",{type:"submit"},"Submit")))}}),k=a(56);var x=class extends s.a.Component{constructor(e){super(e),this.state={input:""}}onSubmit(e){e.preventDefault();let t=this.state.input;if(-1!==t.indexOf("comments")){let e=/\/comments\/([\d\w]+)/,a=t.match(e),n=Object(k.a)(a,2);n[0],t=n[1]}let a=t.replace(/[^\w\d]/g,"");this.props.onSelection(a)}handle(e){this.setState({input:e.target.value})}render(){return s.a.createElement("div",{className:"Thread"},s.a.createElement("h1",null,"Choose a thread"),s.a.createElement("form",{onSubmit:this.onSubmit.bind(this)},s.a.createElement("input",{value:this.state.input,onChange:this.handle.bind(this),placeholder:"Put thread ID or url",autoFocus:!0}),s.a.createElement("button",null,"OK")))}};var _=class extends s.a.Component{constructor(e){super(e),this.state={song:null,songs:null},p().then(e=>{this.setState({songs:e,song:e[0]})})}onSubmit(e){e.preventDefault(),this.props.onSelection({song:this.state.song})}changeSong(e){this.setState({song:e.target.value})}render(){return s.a.createElement("div",{className:"Thread"},s.a.createElement("form",{onSubmit:this.onSubmit.bind(this)},s.a.createElement("div",null,this.state.songs&&s.a.createElement("select",{onChange:this.changeSong.bind(this)},this.state.songs.map(e=>s.a.createElement("option",{key:e},e)))),s.a.createElement("div",null,s.a.createElement("button",{type:"submit"},"Send to the slaughterhouse"))))}};var j=Object(h.b)(e=>({question:e.question,processed:e.processed,stage:e.stage,options:e.options}),{setComments:w,setQuestion:e=>({type:"SET_QUESTION",val:e}),setStage:e=>({type:"SET_STAGE",val:e}),nextStage:T,setOptions:e=>({type:"SET_OPTIONS",val:e})})(class extends s.a.Component{constructor(e){super(e),this.state={stage:0,comments:[],question:null,processed:null,options:{song:null}}}fetchThread(e){d(e).then(e=>{let t=e=>{let a=Object.assign({},e);return Array.isArray(a.replies)&&(a.replies=a.replies.map(t)),{enabled:!1,data:a}},a=e[1].map(t);this.props.setQuestion(e[0]),this.props.setComments(a),this.props.setStage(1)})}addSettings(e){this.props.setOptions(e),this.props.nextStage(),u(this.props.question,this.props.processed,e)}render(){return s.a.createElement("div",{className:"App"},0===this.props.stage?s.a.createElement(x,{onSelection:this.fetchThread.bind(this)}):1===this.props.stage?s.a.createElement(N,null):2===this.props.stage?s.a.createElement(O,null):3===this.props.stage?s.a.createElement(_,{onSelection:this.addSettings.bind(this)}):4===this.props.stage?s.a.createElement("div",null,s.a.createElement("h1",null,"rendering atm bro"),s.a.createElement("p",null,"You may close this tab")):null,s.a.createElement("br",null),0!==this.props.stage&&s.a.createElement("button",{style:{fontSize:12},onClick:()=>this.props.setStage(this.props.stage-1)},"GO BACK!"))}});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(s.a.createElement(h.a,{store:c},s.a.createElement(j,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(e=>{e.unregister()})},57:function(e,t,a){e.exports=a(172)},66:function(e,t,a){}},[[57,1,2]]]);
//# sourceMappingURL=main.91d78a8a.chunk.js.map