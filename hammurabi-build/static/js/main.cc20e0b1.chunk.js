(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{166:function(e,t,n){},167:function(e,t,n){"use strict";n.r(t);var a=n(0),s=n.n(a),i=n(26),r=n.n(i),o=n(48),l=n(49),c=n(53),h=n(50),m=n(54),u="http://localhost:5566/api",d=function(){return fetch(u+"/get-songs").then(function(e){return e.json()})},g=(n(60),n(51)),p=n.n(g);class b extends s.a.Component{handlePress(e){e.stopPropagation()}propagateHtmlChange(e){this.props.comment.data.body_html=e,this.props.onChange()}propagateEnableChange(e){console.log(e.target.checked),this.props.comment.enabled=e.target.checked,this.props.onChange()}render(){let e=this.props,t=e.comment,n=e.onChange;return s.a.createElement("div",{className:"Comment"},s.a.createElement("input",{className:"left-box",type:"checkbox",checked:t.enabled,onChange:this.propagateEnableChange.bind(this)}),s.a.createElement("div",null,s.a.createElement("div",null,"Score: ",t.data.score," - S G P: ",t.data.gildings.gid_1||0," ",t.data.gildings.gid_2||0," ",t.data.gildings.gid_3||0),s.a.createElement(p.a,{style:{display:"inline-block"},onKeyDown:this.handlePress,theme:null,value:t.data.body_html,onChange:this.propagateHtmlChange.bind(this)}),Array.isArray(t.data.replies)&&t.data.replies.map(e=>s.a.createElement(b,{key:e.data.author,comment:e,onChange:n}))))}}var E=b,v=(n(166),13.163),f=.843;function S(e){var t,n=e.replace(/<.+?>/g,"").trim(),a=(t=n,t.split(/<br>|(.+?[\.,?!]+["'\)\s]+)/g).filter(function(e){return e.replace("\u200b"," ").trim().length>0})).length,s=n.replace(/<.+?>/g,"").split(/\s+/g).length;return{words:s,splits:a,estimate:function(e,t){return.38152203637725923*e+.2767486833003453*t}(a,s)}}var y=class extends s.a.Component{constructor(e){super(e);let t=e=>{let n=Object.assign({},e);return Array.isArray(n.replies)&&(n.replies=n.replies.map(t)),{enabled:!1,data:n}},n=e.comments.map(t);this.state={current:0,settings:n},this.onSubmit=this.onSubmit.bind(this),this.handle=this.handle.bind(this),this.toggleCurrent=this.toggleCurrent.bind(this),this.handleKeyEvent=this.handleKeyEvent.bind(this)}handleKeyEvent(e){switch(e.code){case"KeyA":case"ArrowLeft":this.goPrev();break;case"KeyD":case"ArrowRight":this.goNext();break;case"KeyE":case"Space":this.toggleCurrent();break;case"Enter":this.onSubmit()}}componentDidMount(){window.addEventListener("keydown",this.handleKeyEvent)}componentWillUnmount(){window.removeEventListener("keydown",this.handleKeyEvent)}goPrev(){this.state.current>0&&this.setState({current:this.state.current-1})}goNext(){this.state.current<this.state.settings.length-1&&this.setState({current:this.state.current+1})}onSubmit(){let e=t=>t.filter(e=>e.enabled).map(e=>e.data).map(t=>(t.replies=e(t.replies),t)),t=e(this.state.settings);this.props.onSelection(t)}handle(e){this.state.chosen.has(e)?this.state.chosen.set(e):this.state.chosen.add(e),this.setState({chosen:this.state.chosen})}toggleCurrent(){let e=this.state.settings,t=e[this.state.current];t.enabled=!t.enabled,e[this.state.current]=t,console.log(e[this.state.current]),this.setState({settings:e})}toMinSec(e){let t=Math.floor(e/60),n=("00"+Math.round(e-60*t)).slice(-2);return`${("00"+t).slice(-2)}:${n}`}calculateTotalTime(){let e=t=>{let n=t.data.body_html;return Array.isArray(t.data.replies)&&(n+=t.data.replies.filter(e=>e.enabled).map(e).reduce((e,t)=>e+t,"")),n},t=this.state.settings.filter(e=>e.enabled).map(e).map(e=>S(e).estimate);return Math.round(100*function(e){return e.reduce(function(e,t){return e+t},0)+v+f*e.length}(t))/100}onCurrentCommentChange(e){this.setState({settings:this.state.settings})}render(){let e=this.state.settings[this.state.current],t=this.state.settings.filter(e=>e.enabled).length,n=S(e.data.body_html),a=n.estimate,i=n.words,r=n.splits;return s.a.createElement("div",{className:"Comments"},s.a.createElement("div",null,s.a.createElement("div",{className:"top-comment"},s.a.createElement(E,{comment:e,onChange:this.onCurrentCommentChange.bind(this)})),s.a.createElement("div",{className:"options"},s.a.createElement("label",null,s.a.createElement("input",{type:"checkbox",checked:this.state.settings[this.state.current].enabled,onChange:this.toggleCurrent.bind(this)}),"Enable"),s.a.createElement("div",null,"Estimate: ",Math.round(100*a)/100," s, ",i,"/",r)),s.a.createElement("div",{className:"controls"},s.a.createElement("button",{disabled:this.state.current<=0,onClick:this.goPrev.bind(this)},"Prev"),s.a.createElement("input",{style:{width:60},type:"number",value:this.state.current+1,onChange:e=>this.setState({current:Math.max(0,parseInt(e.target.value)-1||0)})}),s.a.createElement("button",{disabled:this.state.current>this.state.settings.length,onClick:this.goNext.bind(this)},"Next")),s.a.createElement("div",{className:"controls"},s.a.createElement("span",null,"Total time: ",this.toMinSec(this.calculateTotalTime()),", ",t," ",1===t?"comment":"comments"," selected"),s.a.createElement("button",{onClick:this.onSubmit},"Finish"))))}},C=n(52);var w=class extends s.a.Component{constructor(e){super(e),this.state={input:""}}onSubmit(e){e.preventDefault();let t=this.state.input;if(-1!==t.indexOf("comments")){let e=/\/comments\/([\d\w]+)/,n=t.match(e),a=Object(C.a)(n,2);a[0],t=a[1]}this.props.onSelection(t)}handle(e){this.setState({input:e.target.value})}render(){return s.a.createElement("div",{className:"Thread"},s.a.createElement("h1",null,"Choose a thread"),s.a.createElement("form",{onSubmit:this.onSubmit.bind(this)},s.a.createElement("input",{value:this.state.input,onChange:this.handle.bind(this),placeholder:"Put thread ID or url",autoFocus:!0}),s.a.createElement("button",null,"OK")))}};var k=class extends s.a.Component{constructor(e){super(e),this.state={song:null,songs:null},d().then(e=>{this.setState({songs:e,song:e[0]})})}onSubmit(e){e.preventDefault(),this.props.onSelection({song:this.state.song})}changeSong(e){this.setState({song:e.target.value})}render(){return s.a.createElement("div",{className:"Thread"},s.a.createElement("form",{onSubmit:this.onSubmit.bind(this)},s.a.createElement("div",null,this.state.songs&&s.a.createElement("select",{onChange:this.changeSong.bind(this)},this.state.songs.map(e=>s.a.createElement("option",{key:e},e)))),s.a.createElement("div",null,s.a.createElement("button",{type:"submit"},"Send to the slaughterhouse"))))}},N=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(c.a)(this,Object(h.a)(t).call(this,e))).state={stage:0,comments:[],question:null,processed:null,options:{song:null}},n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"fetchThread",value:function(e){var t=this;(function(e){return fetch(u+"/get-thread/"+e).then(function(e){return e.json()})})(e).then(function(e){t.setState({question:e[0],comments:e[1],stage:1})})}},{key:"commentsDone",value:function(e){console.log(e),this.setState({processed:e,stage:2})}},{key:"addSettings",value:function(e){console.log(e),this.setState({options:e,stage:3}),function(e,t,n){fetch(u+"/render-video",{method:"POST",body:JSON.stringify({questionData:e,commentData:t,options:n})}).then(function(e){return e.json()})}(this.state.question,this.state.processed,e)}},{key:"render",value:function(){return 0===this.state.stage?s.a.createElement("div",{className:"App"},s.a.createElement(w,{onSelection:this.fetchThread.bind(this)})):1===this.state.stage?s.a.createElement("div",{className:"App"},s.a.createElement(y,{onSelection:this.commentsDone.bind(this),comments:this.state.comments})):2===this.state.stage?s.a.createElement("div",{className:"App"},s.a.createElement(k,{onSelection:this.addSettings.bind(this)})):3===this.state.stage?s.a.createElement("div",{className:"App"},s.a.createElement("h1",null,"rendering atm bro"),s.a.createElement("p",null,"You may close this tab")):void 0}}]),t}(s.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(s.a.createElement(N,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},55:function(e,t,n){e.exports=n(167)},60:function(e,t,n){}},[[55,1,2]]]);
//# sourceMappingURL=main.cc20e0b1.chunk.js.map